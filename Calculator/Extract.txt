app:shapeAppearanceOverlay="@style/RectangularButton"
app:backgroundTint="@color/blacks"
 <TextView
            android:id="@+id/previCal"
            android:layout_marginTop="5dp"
            android:textAlignment="textEnd"
            android:textSize="29sp"
            android:textColor="@color/white"
            android:textStyle="bold|normal"
            android:background="#00000000"
            android:maxLines="1"
            android:enabled="false"
            android:layout_width="match_parent"
            android:layout_height="65dp"/>
        <EditText
            android:id="@+id/display"
            android:textAlignment="textEnd"
            android:textSize="45sp"
            android:hint="0"
            android:textColorHint="@color/white"
            android:textColor="@color/white"
            android:textStyle="bold|normal"
            android:background="#00000000"
            android:maxLines="1"
            android:enabled="false"
            android:layout_width="match_parent"
            android:layout_height="65dp"/>

package com.example.newcalculator

import android.content.pm.ActivityInfo
import androidx.appcompat.app.AppCompatActivity
import android.os.Bundle
import android.os.VibrationEffect
import android.os.Vibrator
import android.text.SpannableStringBuilder
import android.view.View
import android.widget.Button
import android.widget.EditText
import android.widget.TextView
import org.mariuszgromada.math.mxparser.Expression

//import org.mariuszgromada.math.mxparser.Expression

class MainActivity : AppCompatActivity() {
    private lateinit var vibrator: Vibrator
    private lateinit var previousCal: TextView
    private lateinit var display: EditText

    var isPortrait = true

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)

        previousCal = findViewById(R.id.result_tv)
        display = findViewById(R.id.data_tv)
        display.showSoftInputOnFocus = false
        vibrator = getSystemService(VIBRATOR_SERVICE) as Vibrator
    }

    private fun updateText(strToAdd:String){

        val oldStr = display.text.toString()
        val cursorPs = display.selectionStart
        val leftStr = oldStr.substring(0,cursorPs)
        val rightStr = oldStr.substring(cursorPs)
        display.setText(String.format("%s%s%s",leftStr,strToAdd,rightStr))
        display.setSelection(cursorPs + strToAdd.length)
    }
    fun zeroBtn(v: View){
        updateText("0")
    }
    fun Vibrate(){
        if (vibrator.hasVibrator()) {
            val vibrationEffect = VibrationEffect.createOneShot(100, VibrationEffect.DEFAULT_AMPLITUDE)
            vibrator.vibrate(vibrationEffect)
        }
    }
    fun OnDigitClick(view:View){
        Vibrate()
        updateText((view as Button).text.toString())
    }
    fun openBracketBtn(v: View){
        Vibrate()
        updateText(resources.getString(R.string.parenthesesOpenText))
    }
    fun closeBracketBtn(v: View){
        Vibrate()
        updateText(resources.getString(R.string.parenthesesCloseText))
    }
    fun divideBtn(v: View){
        Vibrate()
        updateText(resources.getString(R.string.divideText))
    }
    fun multiplyBtn(v: View){
        Vibrate()
        updateText(resources.getString(R.string.multiplyText))
    }
    fun subtractBtn(v: View){
        Vibrate()
        updateText(resources.getString(R.string.subtractText))
    }

    fun decimialBtn(v: View){
        Vibrate()
        updateText(resources.getString(R.string.decimalText))
    }
    fun addBtn(v: View){
        Vibrate()
        updateText(resources.getString(R.string.addText))
    }
    fun equalBtn(v: View){
        Vibrate()
        var userExp = display.text.toString()
        previousCal.text = userExp
        userExp = userExp.replace(resources.getString(R.string.divideText).toRegex(), "/")
        userExp = userExp.replace(resources.getString(R.string.multiplyText).toRegex(), "*")
        val exp = Expression(userExp)
        val result = exp.calculate().toString()
        display.setText(result)
        display.setSelection(result.length)


    }
    fun clearBtn(v: View){
        Vibrate()
        display.setText("")
        previousCal.text = ""
    }
    fun sinBtn(v: View){
        Vibrate()
        updateText("sin(")
    }
    fun cosBtn(v: View){
        Vibrate()
        updateText("cos(")
    }
    fun tanBtn(v: View){
        Vibrate()
        updateText("tan(")
    }
    fun arcsinBtn(v: View){
        Vibrate()
        updateText("arcsin(")
    }
    fun arccosBtn(v: View){
        Vibrate()
        updateText("arccos(")
    }
    fun arctanBtn(v: View){
        Vibrate()
        updateText("arctan(")
    }
    fun logTwoBtn(v: View){
        Vibrate()
        updateText("log2(")
    }
    fun naturalLogBtn(v: View){
        Vibrate()
        updateText("ln(")
    }
    fun absBtn(v: View){
        Vibrate()
        updateText("abs(")
    }
    fun piBtn(v: View){
        Vibrate()
        updateText("pi")
    }
    fun eBtn(v: View){
        Vibrate()
        updateText("e")
    }
    fun sqrtBtn(v: View){
        Vibrate()
        updateText("sqrt(")
    }
    fun xSquareBtn(v: View){
        Vibrate()
        updateText("^(2)")
    }
    fun xPowYBtn(v: View){
        Vibrate()
        updateText("^(")
    }
    fun OnPrimeClick(v: View){
        Vibrate()
        updateText("ispr(")
    }

    fun backSpaceBtn(v: View){
        Vibrate()
        val cursorPos = display.selectionStart
        val textLen = display.text.length
        if (cursorPos != 0 && textLen != 0){
            val selection = display.text as SpannableStringBuilder
            selection.replace(cursorPos -1,cursorPos,"")
            display.text = selection
            display.setSelection(cursorPos -1)
        }

    }
    fun rotateBtn(v: View){

        requestedOrientation = if (isPortrait){
            ActivityInfo.SCREEN_ORIENTATION_REVERSE_LANDSCAPE
        }
        else{
            ActivityInfo.SCREEN_ORIENTATION_REVERSE_PORTRAIT
        }
        isPortrait = !isPortrait
    }

}